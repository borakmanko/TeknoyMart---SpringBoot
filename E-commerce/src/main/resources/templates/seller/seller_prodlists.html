<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  th:replace="~{header::layout(~{::section})}"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Seller Products</title>
    <link
      rel="stylesheet"
      href="/webjars/bootstrap/5.3.0/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="/webjars/bootstrap-icons/1.11.3/font/bootstrap-icons.css"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <section>
      <div class="container-fluid">
        <div class="row">
          <!-- Sidebar -->
          <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
            <div class="position-sticky pt-3">
              <ul class="nav flex-column">
                <li class="nav-item">
                  <a class="nav-link mb-3" href="/seller">
                    <i class="bi bi-speedometer me-2"></i>Dashboard
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link mb-3" href="/seller/addProduct">
                    <i class="bi bi-basket3-fill me-2"></i>Add Product
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link mb-3" href="/orders">
                    <i class="bi bi-list-task me-2"></i>Orders
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link mb-3" href="/seller/products">
                    <i class="bi bi-bag-dash-fill me-2"></i>Products List
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link mb-3" href="/messages">
                    <i class="bi bi-chat-dots-fill me-2"></i>Messages
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link mb-3" href="/ssettings">
                    <i class="bi bi-gear-fill me-2"></i>Settings
                  </a>
                </li>
                <!-- Logout -->
                <li class="nav-item">
                  <a class="nav-link mb-3" href="/logout">
                    <i class="bi bi-box-arrow-right me-2"></i>Logout
                  </a>
                </li>
              </ul>
            </div>
          </nav>
          <!-- Main content -->
          <main class="col-md-9 ms-sm-auto col-lg-10">
            <div class="content" style="scrollbar-width: thin">
              <div
                class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"
              >
                <h1 class="h2 maroon-text">Products</h1>
              </div>
              <!-- Product Statistics -->
              <div class="row mt-4">
                <div class="col-md-4">
                  <div class="card">
                    <div class="card-body">
                      <h5 class="card-title maroon-text">Total Products</h5>
                      <p class="card-text display-4">150</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card">
                    <div class="card-body">
                      <h5 class="card-title maroon-text">Active Listings</h5>
                      <p class="card-text display-4">120</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card">
                    <div class="card-body">
                      <h5 class="card-title maroon-text">Out of Stock</h5>
                      <p class="card-text display-4">30</p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Search and Filter -->
              <div class="row mb-3 mt-3">
                <div class="col-md-6">
                  <div class="input-group">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Search products..."
                    />
                    <button class="btn btn-outline-secondary" type="button">
                      <i class="bi bi-search"></i>
                    </button>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="d-flex justify-content-end">
                    <select class="form-select me-2" style="width: auto">
                      <option selected>All Categories</option>
                      <option>Electronics</option>
                      <option>Fashion</option>
                      <option>Home & Garden</option>
                    </select>
                    <select class="form-select" style="width: auto">
                      <option selected>All Status</option>
                      <option>Active</option>
                      <option>Out of Stock</option>
                      <option>Ended</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- Product Table -->
              <div class="card">
                <div class="card-header">
                  <h5 class="card-title mb-0 maroon-text">Products List</h5>
                  <th:block th:if="${session.succMsg}">
                    <div class="alert alert-success">
                      [[${session.succMsg}]]
                    </div>
                    <th:block
                      th:text="${@commnServiceImpl.removeSessionMessage()}"
                    ></th:block>
                  </th:block>

                  <th:block th:if="${session.errorMsg}">
                    <div class="alert alert-danger">
                      [[${session.errorMsg}]]
                    </div>
                    <th:block
                      th:text="${@commnServiceImpl.removeSessionMessage()}"
                    ></th:block>
                  </th:block>
                </div>
                <div class="card-body">
                  <div class="table-responsive">
                    <table
                      class="table table-striped table-responsive table-sm text-center"
                    >
                      <thead>
                        <tr>
                          <th scope="col">Product Id</th>
                          <th scope="col">Product Name</th>
                          <th scope="col">Image</th>
                          <th scope="col">Category</th>
                          <th scope="col">Price</th>
                          <th scope="col">Discount</th>
                          <th scope="col">Discounted Price</th>
                          <th scope="col">Status</th>
                          <th scope="col">Stock</th>
                          <th scope="col">Action</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr th:each="p,c:${products}">
                          <th scope="row">[[${c.count}]]</th>
                          <td>[[${p.title}]]</td>
                          <td>
                            <img
                              th:src="@{'/images/product_img/'+${p.image}}"
                              width="70px"
                              height="70px"
                            />
                          </td>
                          <td>[[${p.category}]]</td>
                          <td>&#8369; [[${p.price}]]</td>
                          <td>[[${p.discount}]]</td>
                          <td>&#8369; [[${p.discountPrice}]]</td>
                          <td>
                            <span
                              th:text="${p.isActive} ? 'Active' : 'Inactive'"
                              th:class="${p.isActive} ? 'text-success' : 'text-danger'"
                            ></span>
                          </td>
                          <td>[[${p.stock}]]</td>
                          <td>
                            <a
                              th:href="@{'/seller/editProduct/'+${p.id}}"
                              class="btn btn-sm btn-primary rounded"
                              ><i class="bi bi-pencil-square"></i
                            ></a>

                            <button
                              class="btn btn-sm btn-danger rounded delete-product"
                              th:data-product-id="${p.id}"
                              th:data-product-name="${p.title}"
                            >
                              <i class="bi bi-trash"></i>
                            </button>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <!-- Pagination -->
                  <nav aria-label="Product list pagination">
                    <ul class="pagination justify-content-center">
                      <li class="page-item disabled">
                        <a
                          class="page-link"
                          href="#"
                          tabindex="-1"
                          aria-disabled="true"
                          >Previous</a
                        >
                      </li>
                      <li class="page-item active" aria-current="page">
                        <a class="page-link" href="#">1</a>
                      </li>
                      <li class="page-item">
                        <a class="page-link" href="#">2</a>
                      </li>
                      <li class="page-item">
                        <a class="page-link" href="#">3</a>
                      </li>
                      <li class="page-item">
                        <a class="page-link" href="#">Next</a>
                      </li>
                    </ul>
                  </nav>
                </div>
              </div>
            </div>
          </main>
        </div>
      </div>
      <!-- Delete Confirmation Modal -->
      <div
        class="modal fade"
        id="deleteConfirmModal"
        tabindex="-1"
        aria-labelledby="deleteConfirmModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="deleteConfirmModalLabel">
                Confirm Product Deletion
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              Are you sure you want to delete the product:
              <span id="productNameToDelete"></span>?
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cancel
              </button>
              <a href="#" id="confirmDeleteBtn" class="btn btn-danger">Delete</a>
            </div>
          </div>
        </div>
      </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const deleteModal = new bootstrap.Modal(
          document.getElementById("deleteConfirmModal")
        );
        const confirmDeleteBtn = document.getElementById("confirmDeleteBtn");
        const productNameToDelete = document.getElementById(
          "productNameToDelete"
        );

        document.querySelectorAll(".delete-product").forEach((button) => {
          button.addEventListener("click", function (e) {
            e.preventDefault();
            const productId = this.getAttribute("data-product-id");
            const productName = this.getAttribute("data-product-name");
            confirmDeleteBtn.href = `/seller/deleteProduct/${productId}`;
            productNameToDelete.textContent = productName;
            deleteModal.show();
          });
        });
      });
    </script>
    </section>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/webjars/jquery/3.6.0/jquery.min.js"></script>
    <script src="/webjars/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
