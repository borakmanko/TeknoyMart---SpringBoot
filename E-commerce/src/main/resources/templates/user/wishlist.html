<!DOCTYPE html>
<html
  lang="en"
  xmlns:th="http://www.thymeleaf.org"
  th:replace="~{header::layout(~{::section})}"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wishlist</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <section>
      <div class="container my-4">
        <header class="mb-4">
          <h2 class="fw-bold">Wishlist</h2>
          <small>Your dream products, just a click away!</small>
        </header>
        <th:block th:if="${session.succMsg}">
          <p class="text-success alert alert-success text-center" role="alert">
            [[${session.succMsg}]]
          </p>
          <th:block
            th:text="${@commnServiceImpl.removeSessionMessage()}"
          ></th:block>
        </th:block>

        <th:block th:if="${session.errorMsg}">
          <p class="text-danger text-center alert alert-danger">
            [[${session.errorMsg}]]
          </p>
          <th:block
            th:text="${@commnServiceImpl.removeSessionMessage()}"
          ></th:block>
        </th:block>
        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
          <div class="col" th:each="w:${wishlists}">
            <div class="card h-100 wishlist-item">
              <img
                th:src="@{'/images/product_img/' + ${w.product.image}}"
                class="card-img-top"
                alt="[[${w.product.title}]]"
              />
              <div class="card-body p-3">
                <h5 class="card-title">[[${w.product.title}]]</h5>
                <p class="card-text text-muted">[[${w.product.description}]]</p>
                <p class="mb-0">&#8369; [[${w.product.discountPrice}]]</p>
              </div>
              <div
                class="card-footer bg-transparent border-top-0 d-flex justify-content-between p-3"
              >
                <a
                  th:href="@{'/user/addFromWishlist?productItemId='+${w.product.itemId}+'&uid='+${w.user.id}}"
                  class="btn btn-ebay btn-sm"
                  title="Add to Cart"
                >
                  Add to Cart
                </a>
                <button
                  type="button"
                  class="btn btn-outline-secondary rounded btn-sm remove-wishlist-item"
                  title="Remove from Wishlist"
                  th:data-product-id="${w.product.id}"
                >
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
        <th:block th:unless="${wishlists.size()}">
          <div class="text-center my-5 pb-5">
            <h3 class="text-danger">Your Wishlist is Empty!</h3>
            <small class="text-muted">Explore more and shortlist your favorite products</small> <br>
            <a href="/products" type="button" class="btn btn-ebay mt-3 p-2">Start Shopping!</a>
          </div>
        </th:block>
      </div>

      <!-- Confirmation Modal -->
      <div class="modal fade" id="removeConfirmModal" tabindex="-1" aria-labelledby="removeConfirmModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="removeConfirmModalLabel">Confirm Removal</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              Are you sure you want to remove this item from your wishlist?
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <a href="#" id="confirmRemove" class="btn btn-danger">Confirm</a>
            </div>
          </div>
        </div>
      </div>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const removeModal = new bootstrap.Modal(document.getElementById('removeConfirmModal'));
        const confirmRemoveBtn = document.getElementById('confirmRemove');

        document.querySelectorAll('.remove-wishlist-item').forEach(button => {
          button.addEventListener('click', function(e) {
            e.preventDefault();
            const productId = this.getAttribute('data-product-id');
            confirmRemoveBtn.href = `/user/wishlist/remove/${productId}`;
            removeModal.show();
          });
        });
      });
    </script>
    </section>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>